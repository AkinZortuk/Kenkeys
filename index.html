<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custom Keyboard Builder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    .key {
      user-select: none;
      cursor: pointer;
    }
    .key:hover {
      filter: brightness(1.2);
    }
    .group-label {
      font-weight: bold;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body class="bg-gray-900 text-white">
  <!-- Sidebar Customizer Panel -->
  <div class="flex">
    <aside class="w-64 bg-gray-800 p-4 h-screen overflow-y-auto">
      <h2 class="text-xl mb-4 font-semibold">Customizer Panel</h2>

      <!-- Layout Selector -->
      <label class="block mb-2 text-sm">Select Layout:</label>
      <select id="layoutSelector" class="w-full mb-4 p-2 bg-gray-700 text-white rounded">
        <optgroup label="ISO Layouts">
          <option value="iso_109">109-key ISO (Full)</option>
          <option value="iso_105">105-key ISO</option>
          <option value="iso_101_1800">101-key ISO 1800</option>
          <option value="iso_88_tkl">88-key ISO TKL</option>
          <option value="iso_85_75">85-key ISO 75%</option>
          <option value="iso_69_65">69-key ISO 65%</option>
          <option value="iso_62_60">62-key ISO 60%</option>
        </optgroup>
        <optgroup label="ANSI Layouts">
          <option value="ansi_108">108-key ANSI (Full)</option>
          <option value="ansi_104">104-key ANSI</option>
          <option value="ansi_100_1800">100-key ANSI 1800</option>
          <option value="ansi_87_tkl">87-key ANSI TKL</option>
          <option value="ansi_84_75">84-key ANSI 75%</option>
          <option value="ansi_68_65">68-key ANSI 65%</option>
          <option value="ansi_61_60">61-key ANSI 60%</option>
        </optgroup>
      </select>

      <!-- Color Group Picker -->
      <label class="block mb-2 text-sm">Select Group Color:</label>
      <input type="color" id="groupColor" class="w-full mb-4">
      <button onclick="applyGroupColor()" class="w-full bg-blue-600 rounded py-2">Apply to Group</button>

      <!-- Upload Image -->
      <div class="mt-4">
        <label class="block mb-2 text-sm">Upload Image:</label>
        <input type="file" accept="image/*" id="uploadImage" class="mb-2">
        <button onclick="applyImage()" class="w-full bg-green-600 rounded py-2">Apply Image</button>
      </div>

      <!-- Text Input -->
      <div class="mt-4">
        <label class="block mb-2 text-sm">Add Text:</label>
        <input type="text" id="customText" class="w-full p-2 mb-2 bg-gray-700 rounded">
        <button onclick="applyText()" class="w-full bg-yellow-600 rounded py-2">Apply Text</button>
      </div>

      <!-- Layout Print Position & Color -->
      <div class="mt-4">
        <label class="block mb-2 text-sm">Layout Label Position:</label>
        <select id="layoutPosition" class="w-full mb-2 bg-gray-700 rounded">
          <option value="top-left">Top Left</option>
          <option value="center">Center</option>
          <option value="right">Right</option>
          <option value="none">None</option>
        </select>
        <input type="color" id="layoutColor" class="w-full mb-2">
      </div>

      <!-- Download Button -->
      <button onclick="downloadKeyboard()" class="w-full bg-red-600 mt-6 py-2 rounded">Download Layout</button>
    </aside>

    <!-- Main Keyboard Area -->
    <main class="flex-1 p-4 overflow-auto">
      <div id="keyboardArea" class="flex flex-wrap gap-1 justify-center items-center">
        <!-- Keys will be dynamically rendered here -->
      </div>
    </main>
  </div>

  <script>
    // Basic key structure and layout presets (only placeholder shown)
    const layouts = {
      iso_109: ["ESC", "F1", "F2", "F3", "F4" /* Add all 109 keys */],
      ansi_108: ["ESC", "F1", "F2", "F3", "F4" /* Add all 108 keys */]
      // TODO: Add full layouts for each type as arrays of key labels
    };

    const keyboardArea = document.getElementById("keyboardArea");

    function renderLayout(layoutKey) {
      keyboardArea.innerHTML = "";
      const keys = layouts[layoutKey];
      keys.forEach((label, index) => {
        const key = document.createElement("div");
        key.className = "key w-12 h-12 bg-gray-700 text-center rounded flex justify-center items-center text-sm";
        key.textContent = label;
        key.dataset.index = index;
        key.onclick = () => customizeKey(key);
        keyboardArea.appendChild(key);
      });
    }

    document.getElementById("layoutSelector").addEventListener("change", e => {
      renderLayout(e.target.value);
    });

    function applyGroupColor() {
      const color = document.getElementById("groupColor").value;
      document.querySelectorAll(".key").forEach(k => k.style.backgroundColor = color);
    }

    function customizeKey(keyEl) {
      const color = prompt("Pick a color (hex or name):", "#ffffff");
      if (color) keyEl.style.backgroundColor = color;
    }

    function applyImage() {
      const file = document.getElementById("uploadImage").files[0];
      if (!file) return alert("No image selected.");
      const reader = new FileReader();
      reader.onload = function(e) {
        keyboardArea.style.backgroundImage = `url('${e.target.result}')`;
        keyboardArea.style.backgroundSize = 'cover';
      }
      reader.readAsDataURL(file);
    }

    function applyText() {
      const text = document.getElementById("customText").value;
      document.querySelectorAll(".key").forEach(k => k.textContent = text);
    }

    function downloadKeyboard() {
      html2canvas(document.getElementById("keyboardArea")).then(canvas => {
        const link = document.createElement("a");
        link.download = 'keyboard-customization.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    }

    // Initialize default layout
    renderLayout("iso_109");
  </script>
</body>
</html>
